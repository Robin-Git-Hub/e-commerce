{"ast":null,"code":"import * as Realm from \"realm-web\";\nimport { app } from '../../service/mongoDB-sdk';\nimport { addUser, getUser } from \"../../service\";\nimport { handleLogin, handleAuthenticationErrors } from '../../state/actions/authentication';\n\nconst useAuthentication = dispatch => {\n  function handleUserRegistration(newUser) {\n    const userProfile = {\n      first: newUser.first,\n      last: newUser.last,\n      email: newUser.email,\n      city: newUser.country,\n      country: newUser.country,\n      gender: newUser.gender\n    };\n    return new Promise(resolve => {\n      app.emailPasswordAuth.registerUser(newUser.email, newUser.password).then(() => {\n        const credentials = Realm.Credentials.emailPassword(newUser.email, newUser.password);\n        app.logIn(credentials).then(user => {\n          addUser(userProfile);\n          dispatch(handleLogin(userProfile));\n          resolve(user);\n        });\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleUserLogout() {\n    var _app$currentUser;\n\n    console.dir(app.currentUser);\n    (_app$currentUser = app.currentUser) === null || _app$currentUser === void 0 ? void 0 : _app$currentUser.logOut().then(console.log(\"user successfully log out\")).catch(err => console.log(err));\n  }\n\n  async function handleUserLogin(email, password) {\n    return new Promise(resolve => {\n      app.logIn(Realm.Credentials.emailPassword(email, password)).then(async () => {\n        //verify current user\n        const currentUser = await app.currentUser; //retireve user profile\n\n        getUser(currentUser).then(userProfile => {\n          dispatch(handleLogin(userProfile));\n          resolve(userProfile);\n        });\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleAuthentication() {\n    const currentUser = await app.currentUser;\n    getUser(currentUser === null || currentUser === void 0 ? void 0 : currentUser.email).then(userProfile => !!currentUser && dispatch(handleLogin(userProfile))).catch(err => dispatch(handleAuthenticationErrors(err)));\n  }\n\n  return {\n    handleUserRegistration,\n    handleUserLogout,\n    handleAuthentication,\n    handleUserLogin\n  };\n};\n\nexport default useAuthentication;","map":{"version":3,"sources":["/home/crochet/Bureau/Site E-commerce/client/src/lib/hooks/useAuthentication/index.js"],"names":["Realm","app","addUser","getUser","handleLogin","handleAuthenticationErrors","useAuthentication","dispatch","handleUserRegistration","newUser","userProfile","first","last","email","city","country","gender","Promise","resolve","emailPasswordAuth","registerUser","password","then","credentials","Credentials","emailPassword","logIn","user","catch","err","handleUserLogout","console","dir","currentUser","logOut","log","handleUserLogin","handleAuthentication"],"mappings":"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","sourcesContent":["import * as Realm from \"realm-web\";\nimport { app }from '../../service/mongoDB-sdk'\nimport { addUser, getUser } from \"../../service\";\nimport { handleLogin, handleAuthenticationErrors } from '../../state/actions/authentication'\n\nconst useAuthentication = (dispatch) => {\n    function handleUserRegistration(newUser) {\n\n        const userProfile = {\n            first : newUser.first,\n            last: newUser.last,\n            email: newUser.email,\n            city: newUser.country,\n            country: newUser.country,\n            gender: newUser.gender,\n        };\n\n        return new Promise((resolve) => {\n            app.emailPasswordAuth\n            .registerUser(newUser.email, newUser.password)\n            .then(() => {\n                const credentials = Realm.Credentials.emailPassword(\n                    newUser.email,\n                    newUser.password\n                );\n                 app.logIn(credentials).then((user) => {\n                    addUser(userProfile);\n                    dispatch(handleLogin(userProfile));\n                    resolve(user);  \n                 });\n            })\n            .catch((err) => dispatch(handleAuthenticationErrors(err)));\n        });\n    }\n\n    async function handleUserLogout () {\n        console.dir(app.currentUser);\n        app.currentUser?.logOut()\n        .then(console.log(\"user successfully log out\"))\n        .catch((err) => console.log(err));\n    }\n\n    async function handleUserLogin(email, password) {\n        return new Promise((resolve => {\n            app\n            .logIn(Realm.Credentials.emailPassword(email, password))\n            .then(async () => {\n                //verify current user\n                const currentUser = await app.currentUser;\n                //retireve user profile\n                getUser(currentUser)\n                .then(userProfile => {\n                    dispatch(handleLogin(userProfile))\n                    resolve(userProfile)\n                });\n            })\n            .catch((err) => dispatch(handleAuthenticationErrors(err)));\n        }))\n    }\n\n    async function handleAuthentication() {\n        const currentUser = await app.currentUser;\n        getUser(currentUser?.email)\n        .then(userProfile => !!currentUser && dispatch(handleLogin(userProfile)))\n        .catch(err => dispatch(handleAuthenticationErrors(err)))\n    }\n    \n\n    return {\n        handleUserRegistration,\n        handleUserLogout,\n        handleAuthentication,\n        handleUserLogin\n    };\n};\nexport default useAuthentication;"]},"metadata":{},"sourceType":"module"}